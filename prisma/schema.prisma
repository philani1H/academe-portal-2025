generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int                @id @default(autoincrement())
  name             String
  email            String             @unique
  studentNumber    String?            @unique @map("student_number") // 11-digit numeric ID (YYYYPPSSSSC)
  programCode      Int?               @map("program_code") // Program code for students (1-99)
  personalEmail    String?            @map("personal_email") // For external communications (newsletters, updates)
  password_hash    String
  role             String
  department       String?
  subjects         String?            // JSON array of subjects/courses taught (for tutors)
  createdAt        DateTime?          @default(now()) @map("created_at")
  updatedAt        DateTime?          @default(now()) @updatedAt @map("updated_at")
  courses            Course[]
  notifications      Notification[]
  courseEnrollments  CourseEnrollment[]
  testSubmissions    TestSubmission[]
  scheduledSessions  ScheduledSession[]
  payslips           Payslip[]
  financialRecords   FinancialRecord[]
  timetableEntries   TimetableEntry[]
  timetableDocuments TimetableDocument[]

  @@map("users")
}

model ScheduledSession {
  id          String   @id @default(uuid())
  courseId    Int      @map("course_id")
  tutorId     Int      @map("tutor_id")
  title       String
  description String?
  scheduledAt DateTime @map("scheduled_at")
  duration    Int      // minutes
  status      String   @default("scheduled") // scheduled, active, completed, cancelled
  sessionId   String?  @map("session_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  course      Course   @relation(fields: [courseId], references: [id])
  tutor       User     @relation(fields: [tutorId], references: [id])

  @@map("scheduled_sessions")
}

model AdminUser {
  id            Int      @id @default(autoincrement())
  username      String   @unique
  displayName   String?  @map("display_name")
  email         String?  @unique
  personalEmail String?  @map("personal_email")
  passwordHash  String   @map("password_hash")
  permissions   String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("admin_users")
}

model Course {
  id                Int                @id @default(autoincrement())
  name              String
  description       String?
  category          String?            // This is the subject/course name
  department        String?            // Auto-assigned based on category
  tutorId           Int?               @map("tutor_id")
  createdAt         DateTime?          @default(now()) @map("created_at")
  updatedAt         DateTime?          @default(now()) @updatedAt @map("updated_at")
  tutor             User?              @relation(fields: [tutorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  courseEnrollments CourseEnrollment[]
  tests             Test[]
  materials         CourseMaterial[]
  announcements     CourseAnnouncement[]
  scheduledSessions ScheduledSession[]
  timetableEntries  TimetableEntry[]

  @@map("courses")
}

model CourseMaterial {
  id          String   @id @default(uuid())
  courseId    Int
  name        String
  type        String   // pdf, video, document
  url         String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  course      Course   @relation(fields: [courseId], references: [id])
}

model CourseAnnouncement {
  id        String   @id @default(uuid())
  courseId  Int
  title     String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  course    Course   @relation(fields: [courseId], references: [id])
}

model CourseEnrollment {
  id        String   @id @default(uuid())
  userId    Int
  courseId  Int
  status    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  course    Course   @relation(fields: [courseId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
}

model Test {
  id          String           @id @default(uuid())
  title       String
  description String?
  dueDate     String?
  totalPoints Int?             @default(0)
  courseId    Int
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  course      Course           @relation(fields: [courseId], references: [id])
  questions   TestQuestion[]
  submissions TestSubmission[]
}

model TestQuestion {
  id       String @id @default(uuid())
  testId   String
  question String
  options  String
  answer   String
  test     Test   @relation(fields: [testId], references: [id])
}

model TestSubmission {
  id        String   @id @default(uuid())
  userId    Int
  testId    String
  answers   String
  score     Float
  createdAt DateTime @default(now())
  test      Test     @relation(fields: [testId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
}

model Notification {
  id        String   @id @default(uuid())
  userId    Int
  title     String?
  message   String
  type      String?
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model HeroContent {
  id                  String   @id @default(uuid())
  title               String
  subtitle            String
  description         String
  buttonText          String
  secondaryButtonText String
  trustIndicatorText  String
  universities        String
  features            String
  backgroundGradient  String
  isActive            Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model Feature {
  id          String   @id @default(uuid())
  title       String
  description String
  icon        String
  benefits    String
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PricingPlan {
  id          String   @id @default(uuid())
  name        String
  price       String
  period      String
  features    String
  notIncluded String
  color       String
  icon        String
  popular     Boolean  @default(false)
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Testimonial {
  id          String   @id @default(uuid())
  content     String
  author      String
  role        String
  subject     String
  improvement String
  image       String
  rating      Int      @default(5)
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model TeamMember {
  id        String   @id @default(uuid())
  name      String
  role      String
  bio       String
  image     String
  isActive  Boolean  @default(true)
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AboutUsContent {
  id                    String   @id @default(uuid())
  goal                  String
  mission               String
  rolesResponsibilities String
  isActive              Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model ContactInfo {
  id        String   @id @default(uuid())
  type      String
  label     String
  value     String
  icon      String?
  isActive  Boolean  @default(true)
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SiteSettings {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  type      String
  label     String
  category  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Tutor {
  id           String   @id @default(uuid())
  name         String
  subjects     String
  image        String
  contactName  String
  contactPhone String
  contactEmail String
  description  String
  ratings      String
  isActive     Boolean  @default(true)
  order        Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Subject {
  id            String   @id @default(uuid())
  name          String
  description   String
  image         String
  category      String
  tutorsCount   Int      @default(0)
  popularTopics String
  difficulty    String
  isActive      Boolean  @default(true)
  order         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model FooterContent {
  id            String   @id @default(uuid())
  companyName   String
  tagline       String
  contactPhone  String
  contactEmail  String
  contactPerson String
  whatsappLink  String
  socialLinks   String
  quickLinks    String
  resourceLinks String
  copyrightText String
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model NavigationItem {
  id        String   @id @default(uuid())
  path      String
  label     String
  type      String
  isActive  Boolean  @default(true)
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BecomeTutorContent {
  id             String   @id @default(uuid())
  title          String
  description    String
  requirements   String
  benefits       String
  applicationUrl String
  formEmbedCode  String?
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model ExamRewriteContent {
  id                 String   @id @default(uuid())
  title              String
  description        String
  heroTitle          String
  heroDescription    String
  benefits           String
  process            String
  subjects           String
  applicationFormUrl String
  grade11FormUrl     String?
  grade12FormUrl     String?
  pricingInfo        String
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model ContactUsContent {
  id           String   @id @default(uuid())
  title        String
  description  String
  logo         String
  formEndpoint String
  contactInfo  String
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model UniversityApplicationContent {
  id           String   @id @default(uuid())
  title        String
  description  String
  services     String
  process      String
  requirements String
  pricing      String
  formUrl      String?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Email {
  id        String   @id @default(uuid())
  from      String
  fromName  String   @map("from_name")
  to        String
  subject   String
  body      String
  htmlBody  String?  @map("html_body")
  timestamp DateTime @default(now())
  read      Boolean  @default(false)
  starred   Boolean  @default(false)
  folder    String   @default("inbox")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([to, folder])
  @@index([from, folder])
  @@map("emails")
}

model Payslip {
  id           String   @id @default(uuid())
  userId       Int      @map("user_id")
  month        String
  year         Int
  basicSalary  Float    @map("basic_salary")
  allowances   Float    @default(0)
  deductions   Float    @default(0)
  netSalary    Float    @map("net_salary")
  paymentDate  String?  @map("payment_date")
  status       String   @default("pending")
  notes        String?
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  user         User     @relation(fields: [userId], references: [id])

  @@map("payslips")
}

model FinancialRecord {
  id              String   @id @default(uuid())
  type            String   // income, expense
  category        String   // salary, subscription, utilities, etc.
  amount          Float
  description     String?
  date            String
  userId          Int?     @map("user_id")
  status          String   @default("completed")
  referenceNumber String?  @map("reference_number")
  paymentMethod   String?  @map("payment_method")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  user            User?    @relation(fields: [userId], references: [id])

  @@map("financial_records")
}

model TimetableEntry {
  id        String   @id @default(uuid())
  day       String
  timeSlot  String   @map("time_slot")
  courseId  Int      @map("course_id")
  tutorId   Int      @map("tutor_id")
  room      String?
  grade     String?
  students  String?
  type      String   @default("lecture")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  course    Course   @relation(fields: [courseId], references: [id])
  tutor     User     @relation(fields: [tutorId], references: [id])

  @@map("timetable_entries")
}

model TimetableDocument {
  id         String   @id @default(uuid())
  filename   String
  filePath   String   @map("file_path")
  uploadedBy Int      @map("uploaded_by")
  processed  Boolean  @default(false)
  createdAt  DateTime @default(now()) @map("created_at")
  uploader   User     @relation(fields: [uploadedBy], references: [id])

  @@map("timetable_documents")
}

model Channel {
  id          String           @id @default(uuid())
  name        String
  description String?
  type        String           @default("team") // team, department, general
  department  String?
  isPrivate   Boolean          @default(false)
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")
  messages    ChannelMessage[]
  members     ChannelMember[]

  @@map("channels")
}

model ChannelMember {
  id        String   @id @default(uuid())
  channelId String   @map("channel_id")
  userId    Int      @map("user_id")
  role      String   @default("member") // admin, member
  joinedAt  DateTime @default(now()) @map("joined_at")
  channel   Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)

  @@unique([channelId, userId])
  @@map("channel_members")
}

model ChannelMessage {
  id        String   @id @default(uuid())
  channelId String   @map("channel_id")
  userId    Int      @map("user_id")
  content   String
  fileUrl   String?  @map("file_url")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  channel   Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)

  @@index([channelId, createdAt])
  @@map("channel_messages")
}

model DirectMessage {
  id         String   @id @default(uuid())
  fromUserId Int      @map("from_user_id")
  toUserId   Int      @map("to_user_id")
  content    String
  fileUrl    String?  @map("file_url")
  read       Boolean  @default(false)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@index([fromUserId, toUserId, createdAt])
  @@index([toUserId, read])
  @@map("direct_messages")
}

model Announcement {
  id         String   @id @default(uuid())
  title      String
  content    String
  type       String   @default("general") // general, department, urgent
  department String?
  authorId   Int      @map("author_id")
  pinned     Boolean  @default(false)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@map("announcements_board")
}
